{
  "dockerfile": [
    {
      "id": "DOCKER-BP-007",
      "name": "apk add Without --no-cache",
      "severity": "LOW",
      "category": "best-practice",
      "cwe": "",
      "message": "apk add without --no-cache. Package cache remains in image, increasing size by 2-5 MB.",
      "file_pattern": "Dockerfile*",
      "rule_type": "dockerfile",
      "matcher": {
        "type": "all_of",
        "conditions": [
          {
            "type": "instruction",
            "instruction": "RUN",
            "contains": "apk add"
          },
          {
            "type": "instruction",
            "instruction": "RUN",
            "not_contains": "--no-cache"
          }
        ]
      }
    },
    {
      "id": "DOCKER-BP-005",
      "name": "apt-get Without --no-install-recommends",
      "severity": "LOW",
      "category": "best-practice",
      "cwe": "",
      "message": "apt-get install without --no-install-recommends. This installs unnecessary packages, increasing image size and attack surface.",
      "file_pattern": "Dockerfile*",
      "rule_type": "dockerfile",
      "matcher": {
        "type": "all_of",
        "conditions": [
          {
            "type": "instruction",
            "instruction": "RUN",
            "contains": "apt-get install"
          },
          {
            "type": "instruction",
            "instruction": "RUN",
            "not_contains": "--no-install-recommends"
          }
        ]
      }
    },
    {
      "id": "DOCKER-SEC-006",
      "name": "Docker Socket Mounted as Volume",
      "severity": "CRITICAL",
      "category": "security",
      "cwe": "CWE-250",
      "message": "Dockerfile mounts Docker socket. This gives the container full control over the host Docker daemon, equivalent to root access.",
      "file_pattern": "Dockerfile*",
      "rule_type": "dockerfile",
      "matcher": {
        "type": "any_of",
        "conditions": [
          {
            "type": "instruction",
            "instruction": "VOLUME",
            "contains": "/var/run/docker.sock"
          },
          {
            "type": "instruction",
            "instruction": "VOLUME",
            "contains": "/run/docker.sock"
          },
          {
            "type": "instruction",
            "instruction": "VOLUME",
            "contains": "docker.sock"
          }
        ]
      }
    },
    {
      "id": "DOCKER-BP-003",
      "name": "Deprecated MAINTAINER Instruction",
      "severity": "INFO",
      "category": "best-practice",
      "cwe": "",
      "message": "MAINTAINER instruction is deprecated. Use LABEL org.opencontainers.image.authors instead.",
      "file_pattern": "Dockerfile*",
      "rule_type": "dockerfile",
      "matcher": {
        "type": "instruction",
        "instruction": "MAINTAINER"
      }
    },
    {
      "id": "DOCKER-BP-022",
      "name": "Missing HEALTHCHECK Instruction",
      "severity": "LOW",
      "category": "best-practice",
      "cwe": "",
      "message": "No HEALTHCHECK instruction. Container health cannot be monitored by orchestrators, reducing reliability and observability.",
      "file_pattern": "Dockerfile*",
      "rule_type": "dockerfile",
      "matcher": {
        "type": "missing_instruction",
        "instruction": "HEALTHCHECK"
      }
    },
    {
      "id": "DOCKER-SEC-001",
      "name": "Container Running as Root - Missing USER",
      "severity": "HIGH",
      "category": "security",
      "cwe": "CWE-250",
      "message": "Dockerfile does not specify USER instruction. Container will run as root by default, which increases the attack surface if the container is compromised.",
      "file_pattern": "Dockerfile*",
      "rule_type": "dockerfile",
      "matcher": {
        "type": "missing_instruction",
        "instruction": "USER"
      }
    },
    {
      "id": "DOCKER-BP-008",
      "name": "pip install Without --no-cache-dir",
      "severity": "LOW",
      "category": "best-practice",
      "cwe": "",
      "message": "pip install without --no-cache-dir. Pip cache remains in image, adding 50-200 MB depending on dependencies.",
      "file_pattern": "Dockerfile*",
      "rule_type": "dockerfile",
      "matcher": {
        "type": "all_of",
        "conditions": [
          {
            "type": "instruction",
            "instruction": "RUN",
            "contains": "pip install"
          },
          {
            "type": "instruction",
            "instruction": "RUN",
            "not_contains": "--no-cache-dir"
          }
        ]
      }
    },
    {
      "id": "DOCKER-AUD-003",
      "name": "Privileged Port Exposed",
      "severity": "MEDIUM",
      "category": "audit",
      "cwe": "",
      "message": "Exposing port below 1024 typically requires root privileges to bind. Consider using non-privileged ports (>1024) with port mapping or granting CAP_NET_BIND_SERVICE capability.",
      "file_pattern": "Dockerfile*",
      "rule_type": "dockerfile",
      "matcher": {
        "type": "instruction",
        "instruction": "EXPOSE",
        "port_less_than": 1024
      }
    },
    {
      "id": "DOCKER-SEC-005",
      "name": "Secret in Build Argument",
      "severity": "CRITICAL",
      "category": "security",
      "cwe": "CWE-538",
      "message": "Build argument name suggests it contains a secret. ARG values are visible in image history via 'docker history'.",
      "file_pattern": "Dockerfile*",
      "rule_type": "dockerfile",
      "matcher": {
        "type": "instruction",
        "instruction": "ARG",
        "arg_name_regex": "(?i)^.*(password|passwd|secret|token|key|apikey|api_key|auth|credential|cred|private|access_token|client_secret).*$"
      }
    },
    {
      "id": "DOCKER-BP-001",
      "name": "Base Image Uses :latest Tag",
      "severity": "MEDIUM",
      "category": "best-practice",
      "cwe": "",
      "message": "Base image uses ':latest' tag or no tag (defaults to latest). This makes builds non-reproducible.",
      "file_pattern": "Dockerfile*",
      "rule_type": "dockerfile",
      "matcher": {
        "type": "instruction",
        "instruction": "FROM",
        "image_tag": "latest"
      }
    }
  ],
  "compose": [
    {
      "id": "COMPOSE-SEC-008",
      "name": "Dangerous Capability Added",
      "severity": "HIGH",
      "category": "security",
      "cwe": "CWE-250",
      "message": "Service adds dangerous capability. These capabilities can be used for container escape or privilege escalation.",
      "file_pattern": "**/docker-compose*.yml",
      "rule_type": "compose",
      "matcher": {
        "type": "service_has",
        "key": "cap_add",
        "contains_any": [
          "SYS_ADMIN",
          "NET_ADMIN",
          "SYS_PTRACE",
          "SYS_MODULE",
          "DAC_READ_SEARCH",
          "ALL"
        ]
      }
    },
    {
      "id": "COMPOSE-SEC-002",
      "name": "Docker Socket Exposed to Container",
      "severity": "CRITICAL",
      "category": "security",
      "cwe": "CWE-250",
      "message": "Service mounts Docker socket. The owner of this socket is root. Giving container access to it is equivalent to giving unrestricted root access to host.",
      "file_pattern": "**/docker-compose*.yml",
      "rule_type": "compose",
      "matcher": {
        "type": "service_has",
        "key": "volumes",
        "contains_any": [
          "/var/run/docker.sock",
          "/run/docker.sock",
          "docker.sock"
        ]
      }
    },
    {
      "id": "COMPOSE-SEC-010",
      "name": "Using Host IPC Mode",
      "severity": "MEDIUM",
      "category": "security",
      "cwe": "CWE-250",
      "message": "Service uses host IPC namespace. Container shares inter-process communication with host.",
      "file_pattern": "**/docker-compose*.yml",
      "rule_type": "compose",
      "matcher": {
        "type": "service_has",
        "key": "ipc",
        "equals": "host"
      }
    },
    {
      "id": "COMPOSE-SEC-007",
      "name": "Using Host Network Mode",
      "severity": "HIGH",
      "category": "security",
      "cwe": "CWE-250",
      "message": "Service uses host network mode. Container shares host network stack, bypassing network isolation.",
      "file_pattern": "**/docker-compose*.yml",
      "rule_type": "compose",
      "matcher": {
        "type": "service_has",
        "key": "network_mode",
        "equals": "host"
      }
    },
    {
      "id": "COMPOSE-SEC-009",
      "name": "Using Host PID Mode",
      "severity": "HIGH",
      "category": "security",
      "cwe": "CWE-250",
      "message": "Service uses host PID namespace. Container can see and potentially signal host processes.",
      "file_pattern": "**/docker-compose*.yml",
      "rule_type": "compose",
      "matcher": {
        "type": "service_has",
        "key": "pid",
        "equals": "host"
      }
    },
    {
      "id": "COMPOSE-SEC-001",
      "name": "Service Running in Privileged Mode",
      "severity": "CRITICAL",
      "category": "security",
      "cwe": "CWE-250",
      "message": "Service is running in privileged mode. This grants container equivalent of root capabilities on the host machine. Can lead to container escapes and privilege escalation.",
      "file_pattern": "**/docker-compose*.yml",
      "rule_type": "compose",
      "matcher": {
        "type": "service_has",
        "key": "privileged",
        "equals": true
      }
    },
    {
      "id": "COMPOSE-SEC-003",
      "name": "Seccomp Confinement Disabled",
      "severity": "HIGH",
      "category": "security",
      "cwe": "CWE-284",
      "message": "Service disables seccomp profile. Container can use all system calls, increasing attack surface.",
      "file_pattern": "**/docker-compose*.yml",
      "rule_type": "compose",
      "matcher": {
        "type": "service_has",
        "key": "security_opt",
        "contains": "seccomp:unconfined"
      }
    },
    {
      "id": "COMPOSE-SEC-006",
      "name": "Container Filesystem is Writable",
      "severity": "LOW",
      "category": "security",
      "cwe": "CWE-732",
      "message": "Service has writable root filesystem. Consider making it read-only for better security.",
      "file_pattern": "**/docker-compose*.yml",
      "rule_type": "compose",
      "matcher": {
        "type": "service_missing",
        "key": "read_only"
      }
    }
  ]
}